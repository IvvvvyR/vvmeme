# 🦦 MemeMaster Pro (v6.4.0)

> **为 AstrBot 打造的拟人化情感伴侣插件**
> 集成了 智能防抖、阴阳历时间感知、表情包管理、长期记忆、思维链过滤 与 主动关怀系统。

![Version](https://img.shields.io/badge/version-6.4.0-blue) ![Platform](https://img.shields.io/badge/AstrBot-NapCat-green)

## ⚠️ 兼容性与重要说明

*   **适配环境**：本插件专为 **AstrBot + NapCat (OneBot v11)** 适配器设计。
*   **私聊特化**：作者主要在**私聊场景**下开发与测试。群聊环境虽然有逻辑支持，但未经验证，建议主要用于私聊陪伴。
*   **核心依赖**：需要安装 `lunar_python` 以支持农历日期显示。

---

## ✨ 核心功能

### 1. 📅 阴阳历时间感知 (Time Awareness)
AI 不再是活在真空里的程序。
*   **实时注入**：每条消息都会自动注入当前的**阳历时间**与**农历日期**（如：`2024-05-20 13:14 (农历四月十三)`）。
*   **场景感知**：AI 会根据时间变化问候（早安/晚安），甚至能记住并在农历生日/节日时送上祝福。

### 2. ⏳ 智能防抖与聚合 (Debounce)
你是否厌倦了还没打完字机器人就秒回？
*   **模拟人类阅读节奏**：当你连续发送多条短消息时，机器人会等待几秒（可配），打包阅读。

### 3. 🧠 长期记忆系统 (Long-term Memory)
让 AI 真正记住你们的过往。
*   **自动总结**：当对话积累到一定条数，自动触发 LLM 总结，写入 `memory.txt`。
*   **智能注入**：根据设定频率，周期性地将长期记忆注入 Prompt，防止 AI 聊久了“忘事”。
*   **Web端热修改**：随时在 WebUI 查看、修改甚至回滚记忆文件。

### 4. 🖼️ 表情包管理 (Meme Gallery)
*   **自动进货**：发送图片时，后台静默鉴定：“这是表情包吗？”如果是，自动分类保存。
*   **视觉指纹去重**：采用 dHash 算法，拒绝重复存图。
*   **Web 管理后台**：支持批量上传、删除、修改标签、一键瘦身。
*   **主动发图**：AI 会根据上下文，自动在回复中插入合适的表情包。

### 5. 🧹 思维链净化 (CoT Filter)
专为 Gemini Flash Thinking / DeepSeek R1 等推理模型打造。
*   **强力过滤**：完美去除 `.thought ... End of thought` 或 XML 格式的思考过程。
*   **分段发送**：模拟人类打字习惯，按句意切分回复，拒绝“刷屏式”长文。

### 6. 👋 主动关怀 (Proactive)
*   **孤单看守者**：如果在设定时间内你没有说话，机器人会结合**时间、记忆、最近聊天记录**，主动发起话题。
*   **防 OOC**：采用“导演式”Prompt，确保主动发起的话题符合人设。

---

## ⚙️ WebUI 配置指南

插件启动后，访问 `http://你的IP:5000` 即可进入管理后台。

### 主要配置项说明

| 配置项 | 推荐值 | 说明 |
| :--- | :--- | :--- |
| **防抖等待 (秒)** | `15` | 等待你把话说完的时间。 |
| **发图概率 (%)** | `50` | AI 回复时带表情包的几率。 |
| **存图冷却 (秒)** | `60` | 防止连续发图刷爆 Token。 |
| **记忆注入频率** | `50` | 建议与总结阈值保持一致，实现无缝记忆衔接。 |
| **总结触发阈值** | `50` | 攒够多少条对话写一次“日记”。 |
| **主动聊天间隔** | `0` 或 `1440` | 分钟数。0 为关闭。1440 为一天。 |
| **静默时间** | `23` - `7` | 晚上23点到早7点，机器人不会主动打扰你。 |

---

## 📥 安装方法

1.  将本插件文件夹放入 AstrBot 的 `data/plugins/` 目录下。
2.  **依赖安装**：确保目录下有 `requirements.txt` 文件，AstrBot 启动时会自动安装 `lunar_python` 等库。
3.  **端口映射**：确保你的 Docker 映射了端口 `5000` (用于 WebUI)。
4.  重启 AstrBot。

---

**Author:** Vvivloy
**License:** MIT
